abstractresource.h


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause
#ifndef ABSTRACTRESOURCE_H
#define ABSTRACTRESOURCE_H

#include <QtQml/qqml.h>
#include <QtNetwork/qrestaccessmanager.h>
#include <QtNetwork/qnetworkrequestfactory.h>
#include <QtCore/qobject.h>

class AbstractResource : public QObject
{
    Q_OBJECT
    QML_ANONYMOUS

public:
    explicit AbstractResource(QObject *parent = nullptr) : QObject (parent)
    {}

    virtual ~AbstractResource() = default;

    void setAccessManager(std::shared_ptr<QRestAccessManager> manager)
    {
        m_manager = manager;
    }

    void setServiceApi(std::shared_ptr<QNetworkRequestFactory> serviceApi)
    {
        m_api = serviceApi;
    }

protected:
    std::shared_ptr<QRestAccessManager> m_manager;
    std::shared_ptr<QNetworkRequestFactory> m_api;
};

#endif // ABSTRACTRESOURCE_H



basiclogin.cpp


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#include "basiclogin.h"

#include <QtNetwork/qhttpheaders.h>
#include <QtNetwork/qrestaccessmanager.h>
#include <QtNetwork/qrestreply.h>

#include <QtCore/qjsondocument.h>
#include <QtCore/qjsonobject.h>

using namespace Qt::StringLiterals;

static constexpr auto tokenField = "token"_L1;
static constexpr auto emailField = "email"_L1;
static constexpr auto idField = "id"_L1;

BasicLogin::BasicLogin(QObject *parent)
    : AbstractResource(parent)
{
}

QString BasicLogin::user() const
{
    return m_user ? m_user->email : QString{};
}

bool BasicLogin::loggedIn() const
{
    return m_user.has_value();
}

void BasicLogin::login(const QVariantMap &data)
{
    m_manager->post(m_api->createRequest(m_loginPath), data, this, [this,  data] (QRestReply &reply) {
        m_user.reset();
        if (const auto json = reply.readJson();
            json && json->isObject() && json->object().contains(tokenField)) {
            m_user = User{data.value(emailField).toString(),
                          (*json)[tokenField].toVariant().toByteArray(),
                          data.value(idField).toInt()};
        }
        QHttpHeaders headers;
        headers.append("token", m_user ? m_user->token : ""_ba);
        m_api->setCommonHeaders(headers);
        emit userChanged();
    });
}

void BasicLogin::logout()
{
    m_manager->post(m_api->createRequest(m_logoutPath), ""_ba, this, [this](QRestReply &reply) {
        if (reply.isSuccess()) {
            m_user.reset();
            m_api->clearCommonHeaders(); // clears 'token' header
            emit userChanged();
        }
    });
}



paginatedresource.h


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause
#ifndef PAGINATEDRESOURCE_H
#define PAGINATEDRESOURCE_H

#include "abstractresource.h"

#include <QtQml/qqml.h>
#include <QtCore/qjsonobject.h>

// This class manages a simple paginated Crud resource,
// where the resource is a paginated list of JSON items
class PaginatedResource : public AbstractResource
{
    Q_OBJECT
    Q_PROPERTY(QList<QJsonObject> data READ data NOTIFY dataUpdated)
    Q_PROPERTY(int page READ page WRITE setPage NOTIFY pageUpdated)
    Q_PROPERTY(int pages READ pages NOTIFY pagesUpdated)
    Q_PROPERTY(QString path MEMBER m_path REQUIRED)
    QML_ELEMENT

public:
    explicit PaginatedResource(QObject *parent = nullptr);
    ~PaginatedResource() override = default;

    QList<QJsonObject> data() const;

    // Total number of pages according to the server
    int pages() const;

    // Current page this resource is on. Changing the page will initiate a refresh.
    // The default page is 1
    int page() const;
    void setPage(int page);

    Q_INVOKABLE void refreshCurrentPage();
    Q_INVOKABLE void update(const QVariantMap &data, int id);
    Q_INVOKABLE void add(const QVariantMap &data);
    Q_INVOKABLE void remove(int id);

signals:
    void dataUpdated();
    void pageUpdated();
    void pagesUpdated();

private:
    void refreshRequestFinished(const QJsonDocument &json);
    void refreshRequestFailed();
    QList<QJsonObject> m_data;
    // The total number of pages as reported by the server responses
    int m_pages = 0;
    // The default page we request if the user hasn't set otherwise
    int m_currentPage = 1;
    QString m_path;
};

#endif // PAGINATEDRESOURCE_H



paginatedresource.cpp


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#include "paginatedresource.h"

#include <QtNetwork/qrestaccessmanager.h>
#include <QtNetwork/qrestreply.h>

#include <QtCore/qjsonarray.h>
#include <QtCore/qjsondocument.h>
#include <QtCore/qjsonobject.h>
#include <QtCore/qurlquery.h>

using namespace Qt::StringLiterals;

static constexpr auto totalPagesField = "total_pages"_L1;
static constexpr auto currentPageField = "page"_L1;
static constexpr auto resourceId = "%1"_L1;

PaginatedResource::PaginatedResource(QObject *parent)
    : AbstractResource(parent)
{
}

QList<QJsonObject> PaginatedResource::data() const
{
    return m_data;
}

int PaginatedResource::pages() const
{
    return m_pages;
}

int PaginatedResource::page() const
{
    return m_currentPage;
}

void PaginatedResource::setPage(int page)
{
    if (m_currentPage == page || page < 1)
        return;
    m_currentPage = page;
    emit pageUpdated();
    refreshCurrentPage();
}

void PaginatedResource::refreshCurrentPage()
{
    QUrlQuery query{{"page"_L1, QString::number(m_currentPage)}};
    m_manager->get(m_api->createRequest(m_path, query), this, [this](QRestReply &reply) {
                       if (const auto json = reply.readJson()) {
                           refreshRequestFinished(*json);
                       } else {
                           refreshRequestFailed();
                       }
                });
}

void PaginatedResource::refreshRequestFinished(const QJsonDocument &json)
{
    m_data.clear();
    const QJsonArray data = json["data"_L1].toArray();
    for (const auto &entry : data)
        m_data.append(entry.toObject());
    m_pages = json[totalPagesField].toInt();
    m_currentPage = json[currentPageField].toInt();
    emit pageUpdated();
    emit pagesUpdated();
    emit dataUpdated();
}

void PaginatedResource::refreshRequestFailed()
{
    if (m_currentPage != 1) {
        // A failed refresh. If we weren't on page 1, try that.
        // Last resource on currentPage might have been deleted, causing a failure
        setPage(1);
    } else {
        // Refresh failed and we we're already on page 1 => clear data
        m_pages = 0;
        emit pagesUpdated();
        if (!m_data.isEmpty()) {
            m_data.clear();
            emit dataUpdated();
        }
    }
}

void PaginatedResource::update(const QVariantMap &data, int id)
{
    m_manager->put(m_api->createRequest(m_path + resourceId.arg(QString::number(id))), data,
                   this, [this](QRestReply &reply) {
                       if (reply.isSuccess())
                           refreshCurrentPage();
                   });
}

void PaginatedResource::add(const QVariantMap &data)
{
    m_manager->post(m_api->createRequest(m_path), data, this, [this](QRestReply &reply) {
        if (reply.isSuccess())
            refreshCurrentPage();
    });
}

void PaginatedResource::remove(int id)
{
    m_manager->deleteResource(m_api->createRequest(m_path + resourceId.arg(QString::number(id))),
                              this, [this](QRestReply &reply) {
                                  if (reply.isSuccess())
                                      refreshCurrentPage();
                              });
}



restservice.h


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#ifndef RESTSERVICE_H
#define RESTSERVICE_H

#include "abstractresource.h"

#include <QtQml/qqml.h>
#include <QtQml/qqmlparserstatus.h>
#include <QtNetwork/qrestaccessmanager.h>
#include <QtNetwork/qnetworkrequestfactory.h>
#include <QtCore/qobject.h>
#include <QtCore/qurl.h>

class RestService : public QObject, public QQmlParserStatus
{
    Q_OBJECT
    Q_PROPERTY(QUrl url READ url WRITE setUrl NOTIFY urlChanged)
    Q_PROPERTY(bool sslSupported READ sslSupported CONSTANT)
    Q_PROPERTY(QQmlListProperty<AbstractResource> resources READ resources)
    Q_CLASSINFO("DefaultProperty", "resources")
    Q_INTERFACES(QQmlParserStatus)
    QML_ELEMENT

public:
    explicit RestService(QObject *parent = nullptr);
    ~RestService() override = default;

    bool sslSupported();

    QUrl url() const;
    void setUrl(const QUrl &url);

    void classBegin() override;
    void componentComplete() override;

    QQmlListProperty<AbstractResource> resources();

signals:
    void urlChanged();

private:
    QList<AbstractResource*> m_resources;
    QNetworkAccessManager m_qnam;
    std::shared_ptr<QRestAccessManager> m_manager;
    std::shared_ptr<QNetworkRequestFactory> m_serviceApi;
};

#endif // RESTSERVICE_H



restservice.cpp


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#include "abstractresource.h"
#include "qrestaccessmanager.h"
#include "restservice.h"

#if QT_CONFIG(ssl)
#include <QtNetwork/qsslsocket.h>
#endif

RestService::RestService(QObject *parent) : QObject(parent)
{
    m_qnam.setAutoDeleteReplies(true);
    m_manager = std::make_shared<QRestAccessManager>(&m_qnam);
    m_serviceApi = std::make_shared<QNetworkRequestFactory>();
}

void RestService::setUrl(const QUrl &url)
{
    if (m_serviceApi->baseUrl() == url)
        return;
    m_serviceApi->setBaseUrl(url);
    emit urlChanged();
}

QUrl RestService::url() const
{
    return m_serviceApi->baseUrl();
}

bool RestService::sslSupported()
{
#if QT_CONFIG(ssl)
    return QSslSocket::supportsSsl();
#else
    return false;
#endif
}

QQmlListProperty<AbstractResource> RestService::resources()
{
    return {this, &m_resources};
}

void RestService::classBegin()
{
}

void RestService::componentComplete()
{
    for (const auto resource : std::as_const(m_resources)) {
         resource->setAccessManager(m_manager);
         resource->setServiceApi(m_serviceApi);
    }
}



main.cpp


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#include <QtQml/qqmlapplicationengine.h>
#include <QtQml/qqmlcontext.h>
#include <QtGui/qguiapplication.h>
//#include <QQuickStyle>


// #include <QFile>
// #include <QSslCertificate>
// #include <QSslConfiguration>

// bool setGlobalSslCertificate(const QString& certPath)
// {
//     // 1. Wczytaj certyfikat z pliku
//     QFile certFile(certPath);
//     if (!certFile.open(QIODevice::ReadOnly)) {
//         qDebug() << "Błąd: Nie można otworzyć pliku certyfikatu:" << certPath;
//         return false;
//     }

//     // Wczytaj certyfikat w formacie PEM
//     QSslCertificate certificate(&certFile, QSsl::Pem);
//     certFile.close();

//     if (certificate.isNull()) {
//         qDebug() << "Błąd: Certyfikat jest nieprawidłowy lub uszkodzony!";
//         return false;
//     }

//     // 2. Pobierz domyślną konfigurację SSL
//     QSslConfiguration sslConfig = QSslConfiguration::defaultConfiguration();

//     // Dodaj certyfikat do listy zaufanych certyfikatów
//     QList<QSslCertificate> caCerts = sslConfig.caCertificates();
//     caCerts.append(certificate);
//     sslConfig.setCaCertificates(caCerts);

//     // 3. Ustaw globalną konfigurację SSL
//     QSslConfiguration::setDefaultConfiguration(sslConfig);

//     qDebug() << "Globalna konfiguracja SSL ustawiona pomyślnie.";
//     return true;
// }








// void skonfigurujZaufanyCertyfikat() {
//     // 1. Załaduj swój certyfikat z zasobów
//     // QFile certFile("/home/rafal/fastapi_ssl/server.crt");
//     // if (!certFile.open(QIODevice::ReadOnly)) {
//     //     qWarning() << "Nie można otworzyć pliku certyfikatu z zasobów:" << certFile.errorString();
//     //     return;
//     // }

//     // // Odczytaj zawartość pliku
//     // QByteArray certData = certFile.readAll();
//     // certFile.close();

//     // Utwórz obiekt QSslCertificate
//     // QSslCertificate::fromData może zwrócić listę, jeśli plik PEM zawiera łańcuch
//     QList<QSslCertificate> certificates = QSslCertificate::fromPath(QStringLiteral(":/assets/server.crt"));
//     if (certificates.isEmpty()) {
//         qWarning() << "Nie udało się załadować certyfikatu lub plik jest pusty/nieprawidłowy.";
//         return;
//     }

//     // Możesz wziąć pierwszy lub wszystkie, jeśli twój plik .pem zawiera cały łańcuch
//     // Dla pojedynczego certyfikatu self-signed, wystarczy pierwszy.
//     QSslCertificate selfSignedCertificate = certificates.first();
//     // Lub jeśli chcesz dodać wszystkie z pliku:
//     // QList<QSslCertificate> selfSignedCertificates = certificates;


//     // 2. Pobierz domyślną konfigurację SSL
//     QSslConfiguration sslConfig = QSslConfiguration::defaultConfiguration();

//     // 3. Pobierz listę aktualnie zaufanych certyfikatów CA
//     QList<QSslCertificate> caCertificates = sslConfig.caCertificates();

//     // 4. Dodaj swój certyfikat do listy zaufanych CA
//     // Jeśli używasz QList<QSslCertificate> selfSignedCertificates:
//     // caCertificates.append(selfSignedCertificates);
//     // Dla pojedynczego certyfikatu:
//     caCertificates.append(selfSignedCertificate);

//     // 5. Ustaw zaktualizowaną listę certyfikatów CA w konfiguracji SSL
//     sslConfig.setCaCertificates(caCertificates);

//     // 6. Ustaw tę konfigurację jako domyślną dla wszystkich przyszłych połączeń SSL
//     QSslConfiguration::setDefaultConfiguration(sslConfig);

//     qDebug() << "Konfiguracja SSL zaktualizowana o własny certyfikat.";
// }




int main(int argc, char *argv[])
{
    QGuiApplication app(argc, argv);

    //QQuickStyle::setStyle(QLatin1String("Material"));





    // // Przykład użycia funkcji
    // QString certPath = "/home/rafal/fastapi_ssl/server.crt"; // Podaj ścieżkę do certyfikatu

    // if (!setGlobalSslCertificate(certPath)) {
    //     qDebug() << "Nie udało się ustawić globalnej konfiguracji SSL.";
    //     return -1;
    // }


    // skonfigurujZaufanyCertyfikat();





    QQmlApplicationEngine engine;
#ifdef Q_OS_MACOS
    engine.addImportPath(app.applicationDirPath() + "/../PlugIns");
#endif
    QObject::connect(&engine, &QQmlApplicationEngine::objectCreationFailed, &app,
                     [](){ QCoreApplication::exit(EXIT_FAILURE);}, Qt::QueuedConnection);
    engine.loadFromModule("ColorPalette", "Main");
    //engine.load("http://127.0.0.1/Main.qml");
    //engine.load("/home/rafal/Dokumenty/GITHUB_MOJE/rafal-tarnow.github.io/PROJECT_qml_site/Main.qml");

    return QGuiApplication::exec();
}



basiclogin.h


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#ifndef LOGINSERVICE_H
#define LOGINSERVICE_H

#include "abstractresource.h"

#include <QtQml/qqml.h>

class BasicLogin: public AbstractResource
{
    Q_OBJECT
    Q_PROPERTY(QString user READ user NOTIFY userChanged)
    Q_PROPERTY(bool loggedIn READ loggedIn NOTIFY userChanged)
    Q_PROPERTY(QString loginPath MEMBER m_loginPath REQUIRED)
    Q_PROPERTY(QString logoutPath MEMBER m_logoutPath REQUIRED)
    QML_ELEMENT

public:
    explicit BasicLogin(QObject *parent = nullptr);

    QString user() const;
    bool loggedIn() const;
    Q_INVOKABLE void login(const QVariantMap &data);
    Q_INVOKABLE void logout();

signals:
    void userChanged();

private:
    struct User {
        QString email;
        QByteArray token;
        int id;
    };
    QString m_loginPath;
    QString m_logoutPath;
    std::optional<User> m_user;
};

#endif // LOGINSERVICE_H



CMakeLists.txt


# Copyright (C) 2023 The Qt Company Ltd.
# SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

cmake_minimum_required(VERSION 3.16)
project(KIKODictionaryClient LANGUAGES CXX)

find_package(Qt6 REQUIRED COMPONENTS Core Gui Qml Quick)
qt_standard_project_setup(REQUIRES 6.8)

# Add SSL android support
if (ANDROID)
    include(FetchContent)
    FetchContent_Declare(
        android_openssl
        DOWNLOAD_EXTRACT_TIMESTAMP true
        URL https://github.com/KDAB/android_openssl/archive/refs/heads/master.zip
    )
    FetchContent_MakeAvailable(android_openssl)
    include(${android_openssl_SOURCE_DIR}/android_openssl.cmake)
endif()


qt_add_executable(dudu
    main.cpp
)

set_target_properties(dudu PROPERTIES
    WIN32_EXECUTABLE TRUE
    MACOSX_BUNDLE TRUE
)

add_subdirectory(QtExampleStyle)

qt_add_qml_module(dudu
    URI ColorPalette
    QML_FILES
        ColorPalette/Main.qml
        ColorPalette/ServerSelection.qml
        ColorPalette/ColorView.qml
        ColorPalette/ColorDialogEditor.qml
        ColorPalette/ColorDialogDelete.qml
        ColorPalette/UserMenu.qml
        ColorPalette/PagesModel.qml
        ColorPalette/Sentences.qml
        ColorPalette/SentenceDialogEditor.qml
    SOURCES
        abstractresource.h
        basiclogin.h basiclogin.cpp
        restservice.h restservice.cpp
        paginatedresource.h paginatedresource.cpp
    RESOURCES
        icons/qt.png
        icons/testserver.png
        icons/userMask.svg
        icons/close.svg
        icons/delete.svg
        icons/dots.svg
        icons/edit.svg
        icons/login.svg
        icons/logout.svg
        icons/ok.svg
        icons/update.svg
        icons/user.svg
        icons/plus.svg
        icons/navi-drawer-svgrepo-com.svg
        qtquickcontrols2.conf
        QML_FILES ColorPalette/SentenceDialogDelete.qml
)

# add SSL support for android
if (ANDROID)
    add_android_openssl_libraries(dudu)
endif()

qt_add_resources(dudu "assets"
    PREFIX
        "/"
    FILES
        assets/server.crt
)

target_link_libraries(dudu PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Qml
    Qt6::Quick
)


install(TARGETS dudu
    BUNDLE  DESTINATION .
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
)

qt_generate_deploy_qml_app_script(
    TARGET dudu
    OUTPUT_SCRIPT deploy_script
    MACOS_BUNDLE_POST_BUILD
    NO_UNSUPPORTED_PLATFORM_ERROR
    DEPLOY_USER_QML_MODULES_ON_UNSUPPORTED_PLATFORM
)
install(SCRIPT ${deploy_script})



ColorPalette/ServerSelection.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

import QtExampleStyle

pragma ComponentBehavior: Bound

Rectangle {
    id: root
    // A popup for selecting the server URL

    signal serverSelected()

    required property PaginatedResource colorResources
    required property PaginatedResource colorUsers
    required property RestService restPalette

    Connections {
        target: root.colorUsers
        // Closes the URL selection popup once we have received data successfully
        function onDataUpdated() {
            fetchTester.stop()
            root.serverSelected()
        }
    }


    ListModel {
        id: server
        ListElement {
            title: qsTr("Public REST API Test Server")
            url: "https://reqres.in/api"
            //url: "http://192.168.0.129:49425/api"
            icon: "qrc:/qt/qml/ColorPalette/icons/testserver.png"
        }
        ListElement {
            title: qsTr("Production REST API server")
            url: "https://sentences.rafal-kruszyna.org/api"
            icon: "qrc:/qt/qml/ColorPalette/icons/qt.png"
        }
        ListElement {
            title: qsTr("Development REST API server")
            url: "https://192.168.0.129:8000/api"
            icon: "qrc:/qt/qml/ColorPalette/icons/qt.png"
        }
    }


    ColumnLayout {
        anchors.fill: parent
        anchors.margins: 10
        spacing: 10

        Image {
            Layout.alignment: Qt.AlignHCenter
            source: "qrc:/qt/qml/ColorPalette/icons/qt.png"
            fillMode: Image.PreserveAspectFit
            Layout.preferredWidth: 20
            Layout.preferredHeight: 50
        }

        Label {
            text: qsTr("Choose a server")
            Layout.alignment: Qt.AlignHCenter
            Layout.preferredHeight: 50

            font.pixelSize: 24
        }

        component ServerListDelegate: Rectangle {
            id: serverListDelegate
            required property string title
            required property string url
            required property string icon
            required property int index

            radius: 10
            color: "#00000000"

            border.color: ListView.view.currentIndex === index ? "#2CDE85" : "#E0E2E7"
            border.width: 2

            implicitWidth: 250
            implicitHeight: 100

            Rectangle {
                id: img
                anchors.left: parent.left
                anchors.top: parent.top
                anchors.topMargin: 10
                anchors.leftMargin: 20

                width: 30
                height: 30
                radius: 200
                border. color: "#E7F4EE"
                border.width: 5

                Image {
                        anchors.centerIn: parent
                        source: serverListDelegate.icon
                        width: 15
                        height: 15
                        fillMode: Image.PreserveAspectFit
                        smooth: true
                    }
                }

                Text {
                    text: parent.url

                    anchors.left: parent.left
                    anchors.top: img.bottom
                    anchors.topMargin: 10
                    anchors.leftMargin: 20
                    color: "#667085"
                    font.pixelSize: 13
                }
                Text {
                    text: parent.title

                    anchors.horizontalCenter: parent.horizontalCenter
                    anchors.bottom: parent.bottom
                    anchors.bottomMargin: 10
                    color: "#222222"
                    font.pixelSize: 11
                    font.bold: true
                }

                MouseArea {
                anchors.fill: parent
                onClicked: serverList.currentIndex = serverListDelegate.index;
            }
        }

        ListView {
            id: serverList
            Layout.alignment: Qt.AlignHCenter
            Layout.minimumHeight: 200
            Layout.preferredWidth: 250
            //Layout.preferredHeight: parent.height*0.6
            Layout.fillHeight: true
            orientation: ListView.Vertical
            clip: true

            model: server
            spacing: 20

            delegate: ServerListDelegate {
            }
        }



        Button {
            Layout.alignment: Qt.AlignHCenter
            Layout.preferredHeight: 40
            text: restPalette.sslSupported ? qsTr("Connect (SSL)") : qsTr("Connect")

            buttonColor: "#2CDE85"
            textColor: "#FFFFFF"

            onClicked: {
                console.log("connect ...")
                busyIndicatorPopup.title = (serverList.currentItem as ServerListDelegate).title
                busyIndicatorPopup.icon = (serverList.currentItem as ServerListDelegate).icon
                busyIndicatorPopup.open()

                fetchTester.test((serverList.currentItem  as ServerListDelegate).url)
            }
        }

        Timer {
            id: fetchTester
            interval: 2000

            function test(url) {
                console.log("fetchTester.test()")
                root.restPalette.url = url
                //root.colorResources.refreshCurrentPage()
                root.colorUsers.refreshCurrentPage()
                start()
            }
            onTriggered: busyIndicatorPopup.close()
        }

    }

    onVisibleChanged: {if (!visible) busyIndicatorPopup.close();}

    Popup {
        id: busyIndicatorPopup
        padding: 10
        modal: true
        focus: true
        anchors.centerIn: parent
        closePolicy: Popup.CloseOnEscape | Popup.CloseOnPressOutsideParent

        property alias title: titleText.text
        property alias icon: titleImg.source

        ColumnLayout {
            id: fetchIndicator
            anchors.fill: parent

            RowLayout {
                Rectangle {
                    Layout.preferredWidth: 50
                    Layout.preferredHeight: 50
                    radius: 200
                    border. color: "#E7F4EE"
                    border.width: 5

                    Image {
                        id: titleImg
                        anchors.centerIn: parent
                        width: 25
                        height: 25
                        fillMode: Image.PreserveAspectFit
                    }
                }

                Label {
                    id: titleText
                    text:""
                    font.pixelSize: 18
                }
            }

            RowLayout {
                Layout.fillWidth: false
                Layout.alignment: Qt.AlignHCenter
                BusyIndicator {
                    running: visible
                    Layout.fillWidth: true
                }

                Label {
                    text: qsTr("Testing URL")
                    font.pixelSize: 18
                }
            }

            Button {
                Layout.alignment: Qt.AlignHCenter
                text: qsTr("Cancel")
                onClicked: {
                    busyIndicatorPopup.close()
                }
            }

        }

    }

    Text{
        font.pointSize: 5
        anchors.left: parent.left
        anchors.bottom: parent.bottom
        color: "red"
        text: "build: 2"
    }
}



ColorPalette/SentenceDialogDelete.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

import QtExampleStyle

Popup {
    id: sentenceDeleter
    padding: 10
    modal: true
    focus: true
    anchors.centerIn: parent
    closePolicy: Popup.CloseOnEscape | Popup.CloseOnPressOutsideParent
    signal deleteClicked(int cid)

    property int colorId: -1

    property string sentenceTxt: ""

    function maybeDelete(data) {
        console.log("maybeDelete = " + data.sentence)
        console.log("maybeDelete = " + data.id)
        sentenceTxt = data.sentence
        colorId = data.id
        open()
    }


    ColumnLayout {
        anchors.fill: parent
        spacing: 10

        Text {
            color: "#222222"
            text: qsTr("Delete Color?")
            font.pixelSize: 16
            font.bold: true
        }

        Text {
            color: "#222222"
            text: qsTr("Are you sure, you want to delete sentence") + " \"" + sentenceDeleter.sentenceTxt + "\"?"
            font.pixelSize: 12
        }

        RowLayout {
            Layout.fillWidth: true
            spacing: 10

            Button {
                Layout.fillWidth: true
                text: qsTr("Cancel")
                onClicked: sentenceDeleter.close()
            }

            Button {
                Layout.fillWidth: true
                text: qsTr("Delete")

                buttonColor: "#CC1414"
                textColor: "#FFFFFF"

                onClicked: {
                    sentenceDeleter.deleteClicked(sentenceDeleter.colorId)
                    sentenceDeleter.close()
                }
            }
       }
    }
}



ColorPalette/Sentences.qml


import QtQuick
import QtQuick.Controls
import QtQuick.Layouts
import QtQuick.Controls.Material

import QtExampleStyle

Page {
    id: root
    required property PaginatedResource sentences
    required property PaginatedResource colors

    visible: true

    Action {
        id: addSentenceAction
        onTriggered: sentenceEditor.createNewSentence()
    }

    SentenceDialogEditor{
        id: sentenceEditor
        width: parent.width

        onSentenceAdded: (sentence, english_translation) => {
                             console.log(sentence + " " + english_translation)
                             root.sentences.add({"sentence" : sentence,
                                                    "language" : "pl",
                                                    "translation" : english_translation})
                         }
        onSentenceUpdated: (sentence, english_translation, sid) => {
                               console.log("onSentenceUpdate: " + sentence + " " + english_translation + " " + sid)
                               root.sentences.update({"sentence" : sentence,
                                                         "language" : "pl",
                                                         "translation" : english_translation},
                                                     sid)
                           }
    }

    SentenceDialogDelete {
        id: colorDeletePopup
        onDeleteClicked: (cid) => {
                             root.sentences.remove(cid)
                         }
    }

    onVisibleChanged: {
        if(root.visible){
            root.sentences.refreshCurrentPage()
        }
    }

    background: Rectangle{
        anchors.fill: parent
        color: "#efeae2"
    }


    contentItem: Item {
        ListView{
            id: sentencesListView
            anchors.fill: parent
            spacing: 10
            clip: true
            footerPositioning: ListView.OverlayFooter
            model: root.sentences.data

            delegate: ItemDelegate {
                id: sentenceItem
                required property var modelData
                width: sentencesListView.width
                height: translationBackground.height > sentenceBackground.height ? (translationBackground.height + editButton.height): (sentenceBackground.height + editButton.height)
                spacing: 10
                z: -1


                Rectangle{
                    id: sentenceBackground
                    color: "#ffffff"
                    anchors.top: sentenceTxt.top
                    anchors.right: sentenceTxt.right
                    anchors.left: sentenceTxt.left
                    height: sentenceTxt.height > translationTxt.height ? sentenceTxt.height : translationTxt.height
                    radius: 10
                    border.width: 1
                    border.color: "#e6d5bb"
                }

                TextEdit{
                    id: sentenceTxt
                    width: parent.width/2
                    anchors.top: parent.top
                    anchors.left: parent.left
                    anchors.right: parent.horizontalCenter
                    anchors.margins: 5
                    text: sentenceItem.modelData.sentence
                    wrapMode: Text.Wrap
                    readOnly: true
                    selectByMouse: true
                    focus: true
                    // Rectangle{
                    //     color: "#44FF0000"
                    //     anchors.fill: parent
                    //     border.color: "#FF0000"
                    // }
                }


                Rectangle{
                    id: translationBackground
                    //color: UIStyle.colorSecondary_2
                    color: "#d9fdd3"
                    height: sentenceTxt.height > translationTxt.height ? sentenceTxt.height : translationTxt.height
                    anchors.top: translationTxt.top
                    anchors.right: translationTxt.right
                    anchors.left: translationTxt.left
                    border.width: 1
                    border.color: "#aeffa1"
                    radius: 10


                }


                TextEdit{
                    id: translationTxt
                    anchors.top: parent.top
                    anchors.left: parent.horizontalCenter
                    anchors.right: parent.right
                    anchors.margins: 5
                    text: sentenceItem.modelData.translation
                    wrapMode: Text.Wrap
                    readOnly: true
                    selectByMouse: true
                    focus: true
                }



                ToolButton {
                    id: deleteButton
                    anchors.top: translationBackground.bottom
                    anchors.right: editButton.left
                    icon.source: UIStyle.iconPath("delete")
                    //enabled: root.loginService.loggedIn
                    onClicked: colorDeletePopup.maybeDelete(sentenceItem.modelData)
                }

                ToolButton{
                    id: editButton
                    anchors.top: translationBackground.bottom
                    anchors.right: translationBackground.right
                    icon.source: UIStyle.iconPath("edit")
                    //enabled: root.loginService.loggedIn
                    onClicked: sentenceEditor.updateSentence(sentenceItem.modelData)
                }

                Rectangle{
                    id: delegateBoundary
                    anchors.fill: parent
                    color: "transparent"
                    border.color: "red"
                    border.width: 1
                    visible: false
                }

            }

            footer : ToolBar{
                visible: root.sentences.pages > 1
                implicitWidth: parent.width
                RowLayout {
                    anchors.fill: parent

                    Item { Layout.fillWidth: true /* spacer */ }

                    Repeater {
                        model: root.sentences.pages

                        ToolButton {
                            id: pageButton
                            text: page
                            font.bold: root.sentences.page === page

                            required property int index
                            readonly property int page: (index + 1)

                            onClicked: root.sentences.page = page

                            Component.onCompleted: {
                                pageButton.contentItem.color = "black"
                            }
                        }
                    }
                }

                background: Rectangle{
                    anchors.fill: parent
                    color: "#f0f2f5"
                }
            }


        }


        RoundButton{
            id: addButton
            text: qsTr("+")
            anchors.right: parent.right
            anchors.bottom: parent.bottom
            anchors.bottomMargin: 50
            height: 50
            width: 50
            radius: 80
            z: 2
            Material.background: Material.Pink
            visible: true
            action: addSentenceAction
            Component.onCompleted: {
                addButton.contentItem.color = "white"
                addButton.contentItem.font.pointSize = "15"
            }
        }

    }

    // footer: ToolBar {

    //     visible: root.sentences.pages > 1
    //     implicitWidth: parent.width

    //     RowLayout {
    //         anchors.fill: parent

    //         Item { Layout.fillWidth: true}

    //         Repeater {
    //             model: root.sentences.pages

    //             ToolButton {
    //                 text: page
    //                 font.bold: root.sentences.page === page

    //                 required property int index
    //                 readonly property int page: (index + 1)

    //                 onClicked: root.sentences.page = page
    //             }
    //         }
    //     }
    // }

}



ColorPalette/ColorDialogEditor.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts
import QtQuick.Dialogs

import QtExampleStyle

Popup {
    id: colorEditor
    // Popup for adding or updating a color
    padding: 10
    modal: true
    focus: true
    anchors.centerIn: parent
    closePolicy: Popup.CloseOnEscape | Popup.CloseOnPressOutsideParent
    signal colorAdded(string name, string color, string pantone_value)
    signal colorUpdated(string name, string color, string pantone_value, int cid)

    property bool newColor: true
    property int colorId: -1
    property alias currentColor: colordialogButton.buttonColor

    function createNewColor() {
        newColor = true
        colorNameField.text = "cute green"
        colorRGBField.text = "#41cd52"
        colorPantoneField.text = "PMS 802C"
        open()
    }

    function updateColor(data) {
        newColor = false
        colorNameField.text = data.name
        currentColor = data.color
        colorPantoneField.text = data.pantone_value
        colorId = data.id
        open()
    }

    ColorDialog {
        id: colorDialog
        title: qsTr("Choose a color")
        onAccepted: {
            colorEditor.currentColor = Qt.color(colorDialog.selectedColor)
            colorDialog.close()
        }
        onRejected: {
            colorDialog.close()
        }
    }

    ColumnLayout {
        anchors.fill: parent
        spacing: 10

        GridLayout {
            columns: 2
            rowSpacing: 10
            columnSpacing: 10

            Label {
                text: qsTr("Color Name")
            }
            TextField {
                id: colorNameField
                padding: 10
            }

            Label {
                text: qsTr("Pantone Value")
            }
            TextField {
                id: colorPantoneField
                padding: 10
            }

            Label {
                text: qsTr("Rgb Value")
            }

            TextField {
                id: colorRGBField
                text: colorEditor.currentColor.toString()
                readOnly: true
                padding: 10
            }
        }

        Button {
            id: colordialogButton
            Layout.fillWidth: true
            Layout.preferredHeight: 30
            text: qsTr("Set Color")
            textColor: isColorDark(buttonColor) ? "#E6E6E6" : "#191919"

            onClicked: colorDialog.open()

            function isColorDark(color) {
                return (0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b) < 0.5;
            }
        }

        RowLayout {
            Layout.fillWidth: true
            spacing: 10

            Button {
                text: qsTr("Cancel")
                onClicked: colorEditor.close()
                Layout.fillWidth: true
            }

            Button {
                Layout.fillWidth: true
                text: colorEditor.newColor ? qsTr("Add") : qsTr("Update")

                buttonColor: "#2CDE85"
                textColor: "#FFFFFF"

                onClicked: {
                    if (colorEditor.newColor) {
                        colorEditor.colorAdded(colorNameField.text,
                                               colorRGBField.text,
                                               colorPantoneField.text)
                    } else {
                        colorEditor.colorUpdated(colorNameField.text,
                                                 colorRGBField.text,
                                                 colorPantoneField.text,
                                                 colorEditor.colorId)
                    }
                    colorEditor.close()
                }
            }
        }
    }
}



ColorPalette/PagesModel.qml


import QtQuick

ListModel {
    ListElement {
        title: qsTr("Colors")
        source: "qrc:/qt/qml/ColorPalette/pages/HomePage.qml"
    }
    ListElement {
        title: qsTr("Sentences")
        source: "qrc:/qt/qml/ColorPalette/pages/list_view/ListViewPage.qml"
    }
}



ColorPalette/ColorDialogDelete.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

import QtExampleStyle

Popup {
    id: colorDeleter
    padding: 10
    modal: true
    focus: true
    anchors.centerIn: parent
    closePolicy: Popup.CloseOnEscape | Popup.CloseOnPressOutsideParent
    signal deleteClicked(int cid)

    property int colorId: -1

    property string colorName: ""

    function maybeDelete(data) {
        console.log("maybeDelete = " + data.name)
        console.log("maybeDelete = " + data.id)
        colorName = data.name
        colorId = data.id
        open()
    }


    ColumnLayout {
        anchors.fill: parent
        spacing: 10

        Text {
            color: "#222222"
            text: qsTr("Delete Color?")
            font.pixelSize: 16
            font.bold: true
        }

        Text {
            color: "#222222"
            text: qsTr("Are you sure, you want to delete color") + " \"" + colorDeleter.colorName + "\"?"
            font.pixelSize: 12
        }

        RowLayout {
            Layout.fillWidth: true
            spacing: 10

            Button {
                Layout.fillWidth: true
                text: qsTr("Cancel")
                onClicked: colorDeleter.close()
            }

            Button {
                Layout.fillWidth: true
                text: qsTr("Delete")

                buttonColor: "#CC1414"
                textColor: "#FFFFFF"

                onClicked: {
                    colorDeleter.deleteClicked(colorDeleter.colorId)
                    colorDeleter.close()
                }
            }
       }
    }
}



ColorPalette/SentenceDialogEditor.qml


import QtQuick
import QtQuick.Controls

Dialog {
    id: root
    padding: 10
    modal: true
    focus: true
    anchors.centerIn: parent
    closePolicy: Popup.CloseOnEscape | Popup.CloseOnPressOutsideParent
    standardButtons: Dialog.Ok | Dialog.Cancel
    signal sentenceAdded(string sentence, string english_translation)
    signal sentenceUpdated(string sentence, string english_translation, int sid)

    property bool newSentence: true
    property int sentenceId: -1

    function createNewSentence() {
        newSentence = true
        open()
    }

    function updateSentence(data) {
        newSentence = false
        console.log("updateSentence()")
        console.log("id=" + data.id)
        console.log("sentence=" + data.sentence)
        sentenceId = data.id
        sentenceField.text = data.sentence
        englishTranslation.text = data.translation
        open()
    }

    onAccepted: {
        console.log("accpeted new sentence")
        if(root.newSentence){
            sentenceAdded(sentenceField.text, englishTranslation.text)
        }else{
            sentenceUpdated(sentenceField.text, englishTranslation.text, root.sentenceId)
        }
    }

    contentItem: Column{

        TextEdit {
            id: sentenceField
            padding: 10
            height: 100
            width: root.width
            wrapMode: TextEdit.Wrap
            selectByMouse: true
            selectByKeyboard: true

            Rectangle{
                color: "#44FF0000"
                anchors.fill: parent
            }
        }
        TextEdit {
            id: englishTranslation
            padding: 10
            height: 100
            width: root.width
            wrapMode: TextEdit.Wrap
            selectByMouse: true
            selectByKeyboard: true

            Rectangle{
                color: "#4400FF00"
                anchors.fill: parent
            }
        }


    }
}



ColorPalette/ColorView.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

pragma ComponentBehavior: Bound

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts
import QtQuick.Effects
import QtQuick.Shapes

import QtExampleStyle

Rectangle {
    id: root
    required property BasicLogin loginService
    required property PaginatedResource colors
    required property PaginatedResource colorViewUsers

    onVisibleChanged: {
        if(root.visible){
            root.colors.refreshCurrentPage()
        }
    }

    Component.onCompleted: {
        root.colors.refreshCurrentPage()
    }

    ColorDialogEditor {
        id: colorPopup
        onColorAdded: (colorNameField, colorRGBField, colorPantoneField) => {
            root.colors.add({"name" : colorNameField,
                        "color" : colorRGBField,
                        "pantone_value" : colorPantoneField})
        }

        onColorUpdated: (colorNameField, colorRGBField, colorPantoneField, cid) => {
            root.colors.update({"name" : colorNameField,
                        "color" : colorRGBField,
                        "pantone_value" : colorPantoneField},
                        cid)
        }
    }

    ColorDialogDelete {
        id: colorDeletePopup
        onDeleteClicked: (cid) => {
            root.colors.remove(cid)
        }
    }

    ColumnLayout {
        // The main application layout
        anchors.fill :parent

        ToolBar {
            Layout.fillWidth: true
            Layout.minimumHeight: 25 + 4

            UserMenu {
                id: userMenu

                userMenuUsers: root.colorViewUsers
                userLoginService: root.loginService
            }

            RowLayout {
                anchors.fill: parent
                Text {
                    text: qsTr("QHTTP Server")
                    font.pixelSize: 8
                }
                Item { Layout.fillWidth: true }

                AbstractButton {
                    id: loginButton
                    Layout.preferredWidth: 25
                    Layout.preferredHeight: 25
                    Item {
                        id: userImageCliped
                        anchors.left: parent.left
                        anchors.verticalCenter: parent.verticalCenter
                        width: 25
                        height: 25

                        Image {
                            id: userImage
                            anchors.fill: parent
                            source: getCurrentUserImage()
                            visible: false

                            function getCurrentUserImage() {
                                if (!root.loginService.loggedIn)
                                    return "qrc:/qt/qml/ColorPalette/icons/user.svg";
                                for (let i = 0; i < users.data.length; i++) {
                                    if (users.data[i].email === loginService.user)
                                        return users.data[i].avatar;
                                }
                            }
                        }

                        Image {
                            id: userMask
                            source: "qrc:/qt/qml/ColorPalette/icons/userMask.svg"
                            anchors.fill: userImage
                            anchors.margins: 4
                            visible: false
                        }

                        MultiEffect {
                            source: userImage
                            anchors.fill: userImage
                            maskSource: userMask
                            maskEnabled: true
                        }
                    }

                    onClicked: {
                        userMenu.open()
                        var pos = mapToGlobal(Qt.point(x, y))
                        pos = userMenu.parent.mapFromGlobal(pos)
                        userMenu.x = x - userMenu.width + 25 + 3
                        userMenu.y = y + 25 + 3
                    }

                    Shape {
                       id: bubble
                       x: -text.width - 25
                       anchors.margins: 3

                       preferredRendererType: Shape.CurveRenderer

                        visible: !root.loginService.loggedIn

                       ShapePath {
                           strokeWidth: 0
                           fillColor: "#667085"
                           startX: 5; startY: 0
                           PathLine { x: 5 + text.width + 6; y: 0 }
                           PathArc { x: 10 + text.width + 6; y: 5; radiusX: 5; radiusY: 5}
                           // arrow
                           PathLine { x: 10 + text.width + 6; y: 8 + text.height / 2 - 6 }
                           PathLine { x: 10 + text.width + 6 + 6; y: 8 + text.height / 2 }
                           PathLine { x: 10 + text.width + 6; y: 8 + text.height / 2 + 6}
                           PathLine { x: 10 + text.width + 6; y: 5 + text.height + 6 }
                           // end arrow
                           PathArc { x: 5 + text.width + 6; y: 10 + text.height + 6 ; radiusX: 5; radiusY: 5}
                           PathLine { x: 5; y: 10 + text.height + 6 }
                           PathArc { x: 0; y: 5 + text.height + 6 ; radiusX: 5; radiusY: 5}
                           PathLine { x: 0; y: 5 }
                           PathArc { x: 5; y: 0 ; radiusX: 5; radiusY: 5}
                       }
                       Text {
                           x: 8
                           y: 8
                           id: text
                           color: "white"
                           text: qsTr("Log in to edit")
                           font.bold: true
                           horizontalAlignment: Qt.AlignHCenter
                           verticalAlignment: Qt.AlignVCenter
                       }
                   }
                }
            }

            Image {
                anchors.centerIn: parent
                source: "qrc:/qt/qml/ColorPalette/icons/qt.png"
                fillMode: Image.PreserveAspectFit
                height: 25
            }

        }
        ToolBar {
            Layout.fillWidth: true
            Layout.minimumHeight: 32

            RowLayout {
                anchors.fill: parent
                Text {
                    Layout.alignment: Qt.AlignVCenter
                    text: qsTr("Color Palette")
                    font.pixelSize: 14
                    font.bold: true
                }

                Item { Layout.fillWidth: true }

                AbstractButton {
                    Layout.preferredWidth: 25
                    Layout.preferredHeight: 25
                    Layout.alignment: Qt.AlignVCenter

                    Rectangle {
                        anchors.fill: parent
                        radius: 4
                        color: "#192CDE85"
                        border.color: "#DDE2E8"
                        border.width: 1
                    }

                    Image {
                        source: UIStyle.iconPath("plus")
                        fillMode: Image.PreserveAspectFit
                        anchors.fill: parent
                        sourceSize.width: width
                        sourceSize.height: height

                    }
                    visible: root.loginService.loggedIn
                    onClicked: colorPopup.createNewColor()
                }

                AbstractButton {
                    Layout.preferredWidth: 25
                    Layout.preferredHeight: 25
                    Layout.alignment: Qt.AlignVCenter

                    Rectangle {
                        anchors.fill: parent
                        radius: 4
                        color: "#192CDE85"
                        border.color: "#DDE2E8"
                        border.width: 1
                    }

                    Image {
                        source: UIStyle.iconPath("update")
                        fillMode: Image.PreserveAspectFit
                        anchors.fill: parent
                        sourceSize.width: width
                        sourceSize.height: height
                    }

                    onClicked: {
                        root.colors.refreshCurrentPage()
                        root.colorViewUsers.refreshCurrentPage()
                    }
                }
            }
        }



        //! [View and model]
        ListView {
            id: colorListView

            model: root.colors.data
        //! [View and model]
            footerPositioning: ListView.OverlayFooter
            spacing: 15
            clip: true

            Layout.fillHeight: true
            Layout.fillWidth: true

            header:  Rectangle {
                height: 32
                width: parent.width
                color: "#F0F1F3"

                RowLayout {
                    anchors.fill: parent

                    component HeaderText : Text {
                        Layout.alignment: Qt.AlignVCenter
                        horizontalAlignment: Qt.AlignHCenter

                        font.pixelSize: 12
                        color: "#667085"
                    }
                    HeaderText {
                        id: headerName
                        text: qsTr("Color Name")
                        Layout.preferredWidth: colorListView.width * 0.3
                    }
                    HeaderText {
                        id: headerRgb
                        text: qsTr("Rgb Value")
                        Layout.preferredWidth: colorListView.width * 0.25
                    }
                    HeaderText {
                        id: headerPantone
                        text: qsTr("Pantone Value")
                        Layout.preferredWidth: colorListView.width * 0.25
                    }
                    HeaderText {
                        id: headerAction
                        text: qsTr("Action")
                        Layout.preferredWidth: colorListView.width * 0.2
                    }
                }
            }

            delegate: Item {
                id: colorInfo

                required property var modelData

                width: colorListView.width
                height: 25
                RowLayout {
                    anchors.fill: parent
                    anchors.leftMargin: 5
                    anchors.rightMargin: 5

                    Rectangle {
                        id: colorSample
                        Layout.alignment: Qt.AlignVCenter
                        implicitWidth: 36
                        implicitHeight: 21
                        radius: 6
                        color: colorInfo.modelData.color
                    }

                    Text {
                        Layout.preferredWidth: colorInfo.width * 0.3 - colorSample.width
                        horizontalAlignment: Qt.AlignLeft
                        leftPadding: 5
                        text: colorInfo.modelData.name
                    }

                    Text {
                        Layout.preferredWidth: colorInfo.width * 0.25
                        horizontalAlignment: Qt.AlignHCenter
                        text: colorInfo.modelData.color
                    }

                    Text {
                        Layout.preferredWidth: colorInfo.width * 0.25
                        horizontalAlignment: Qt.AlignHCenter
                        text: colorInfo.modelData.pantone_value
                    }

                    Item {
                        Layout.maximumHeight: 28
                        implicitHeight: buttonBox.implicitHeight
                        implicitWidth: buttonBox.implicitWidth

                        RowLayout {
                            id: buttonBox
                            anchors.fill: parent
                            ToolButton {
                                icon.source: UIStyle.iconPath("delete")
                                enabled: root.loginService.loggedIn
                                onClicked: colorDeletePopup.maybeDelete(colorInfo.modelData)
                            }
                            ToolButton {
                                icon.source: UIStyle.iconPath("edit")
                                enabled: root.loginService.loggedIn
                                onClicked: colorPopup.updateColor(colorInfo.modelData)
                            }
                        }
                    }
                }
            }

            footer: ToolBar {
                // Paginate buttons if more than one page
                visible: root.colors.pages > 1
                implicitWidth: parent.width


                RowLayout {
                    anchors.fill: parent

                    Item { Layout.fillWidth: true /* spacer */ }

                    Repeater {
                        model: root.colors.pages

                        ToolButton {
                            text: page
                            font.bold: root.colors.page === page

                            required property int index
                            readonly property int page: (index + 1)

                            onClicked: root.colors.page = page
                        }
                    }
                }
            }
        }
    }
}



ColorPalette/Main.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause


// import QtQuick
// import QtQuick.Controls
// import QtQuick.Layouts

// Window {
//     id: root

//     visible: true

//     width: 450
//     height: 700

//     //width: Screen.width
//     //height: Screen.height

//     // Image{
//     // anchors.fill: parent
//     // source: "https://as1.ftcdn.net/v2/jpg/04/97/31/24/1000_F_497312401_fmQQiKYB8QsgZNsdXveTMLLYvMwe3lV9.jpg"
//     // }

//     Loader{
//     anchors.fill: parent
//     asynchronous: true
//     source: "http://127.0.0.1/View.qml"
//     }
// }




pragma ComponentBehavior: Bound

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

import QtExampleStyle

Window {
    id: window
    width: 450
    height: 700
    visible: true
    title: qsTr("Color Palette Client")

    enum DataView {
        UserView = 0,
        ColorView = 1
    }

    function hideAll(){
        serverview.visible = false;
        colorview.visible = false;
        sentencesGui.visible = false;
    }

    Action {
        id: navigateBackAction
        icon.source: "qrc:/qt/qml/ColorPalette/icons/navi-drawer-svgrepo-com.svg"
        icon.width: 20
        icon.height: 20
        onTriggered: {
            drawer.open()
        }
    }

    ListModel {
        id: pagesModel
        ListElement {
            title: "Server selection"
        }
        ListElement {
            title: "Color View"
        }
        ListElement {
            title: "Blue Circle"
        }
    }


    Rectangle{
        color: "#ff8888"
        anchors.horizontalCenter: parent.horizontalCenter
        width: window.width > 500 ? 500 : window.width
        anchors.top: parent.top
        anchors.bottom: parent.bottom

        ToolBar {
            id: menuBar
            anchors.margins: 1
            anchors.top: parent.top
            anchors.left: parent.left
            anchors.right: parent.right
            z: 2
            RowLayout{
                spacing: 20
                anchors.fill: parent

                ToolButton {
                    action: navigateBackAction
                    visible: true
                }
            }
            background: Rectangle{
                color: UIStyle.colorPrimary
            }
        }

        ServerSelection {
            id: serverview
            anchors.margins: 1
            anchors.top: menuBar.bottom
            anchors.right: parent.right
            anchors.left: parent.left
            anchors.bottom: parent.bottom
            visible: true
            onServerSelected: {
                 colorview.visible = true;
                 sentencesGui.visible = false;
                 serverview.visible = false
                console.log("QML on ServerSelection !!!")
                if(serverview.visible === true){
                    hideAll();
                    colorview.visible = true
                }
            }
            colorResources: colors
            restPalette: paletteService
            colorUsers: users
        }

        ColorView {
            id: colorview
            anchors.margins: 1
            anchors.top: menuBar.bottom
            anchors.right: parent.right
            anchors.left: parent.left
            anchors.bottom: parent.bottom
            visible: false
            loginService: colorLogin
            colors: colors
            colorViewUsers: users
        }

        Sentences {
            id: sentencesGui
            anchors.margins: 1
            anchors.top: menuBar.bottom
            anchors.right: parent.right
            anchors.left: parent.left
            anchors.bottom: parent.bottom
            visible: false
            colors: colors
            sentences: sentences
        }
    }

    Drawer{
        id: drawer
        width: 200
        height: parent.height

        ListView {
            id: listView
            anchors.fill: parent
            model: pagesModel
            delegate: ItemDelegate{
                id: delegateItem
                required property string title
                width: listView.width
                text: title
                highlighted: ListView.isCurrentItem

                onClicked: {
                    hideAll();
                    if (title === "Server selection") {
                        serverview.visible = true
                    } else if (title === "Color View") {
                        colorview.visible = true
                    } else if (title === "Blue Circle") {
                        sentencesGui.visible = true
                    }
                    drawer.close()
                }
            }
        }
     }




    //! [RestService QML element]
    RestService {
        id: paletteService

        PaginatedResource {
            id: users
            path: "users"
        }

        PaginatedResource {
            id: sentences
            path: "sentences/"
        }

        PaginatedResource {
            id: colors
            path: "unknown"
        }

        BasicLogin {
            id: colorLogin
            loginPath: "login"
            logoutPath: "logout"
        }
    }
    //! [RestService QML element]

}






ColorPalette/UserMenu.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

pragma ComponentBehavior: Bound

import QtQuick
import QtQuick.Controls
import QtQuick.Layouts
import QtQuick.Effects

import QtExampleStyle

Popup {
    id: userMenu

    required property BasicLogin userLoginService
    required property PaginatedResource userMenuUsers

    width: 280
    height: 270

    ColumnLayout {
        anchors.fill: parent

        ListView {
            id: userListView

            model: userMenu.userMenuUsers.data
            spacing: 5
            footerPositioning: ListView.PullBackFooter
            clip: true

            Layout.fillHeight: true
            Layout.fillWidth: true

            delegate: Rectangle {
                id: userInfo

                height: 30
                width: userListView.width


                required property var modelData
                readonly property bool logged: (modelData.email === loginService.user)

                Rectangle {
                    id: userImageCliped
                    anchors.left: parent.left
                    anchors.verticalCenter: parent.verticalCenter
                    width: 30
                    height: 30

                    Image {
                        id: userImage
                        anchors.fill: parent
                        source: userInfo.modelData.avatar
                        visible: false
                        Component.onCompleted: {
                            console.log("userInfo.modelData.avatar = " + userInfo.modelData.avatar)
                        }
                    }

                    Image {
                        id: userMask
                        source: "qrc:/qt/qml/ColorPalette/icons/userMask.svg"
                        anchors.fill: userImage
                        anchors.margins: 4
                        visible: false
                    }

                    MultiEffect {
                        source: userImage
                        anchors.fill: userImage
                        maskSource: userMask
                        maskEnabled: true
                    }
                }

                Text {
                    id: userMailLabel
                    anchors.left: userImageCliped.right
                    anchors.verticalCenter: parent.verticalCenter
                    anchors.margins: 5
                    text: userInfo.modelData.email
                    font.bold: userInfo.logged
                }

                ToolButton {
                    anchors.right: parent.right
                    anchors.verticalCenter: parent.verticalCenter
                    anchors.margins: 5

                    icon.source: UIStyle.iconPath(userInfo.logged
                                 ? "logout" : "login")
                    enabled: userInfo.logged || !userMenu.userLoginService.loggedIn

                    onClicked: {
                        if (userInfo.logged) {
                            userMenu.userLoginService.logout()
                        } else {
                            //! [Login]
                            userMenu.userLoginService.login({"email" : userInfo.modelData.email,
                                                "password" : "apassword",
                                                "id" : userInfo.modelData.id})
                            //! [Login]
                            userMenu.close()
                        }
                    }
                }

            }
            footer: ToolBar {
                // Paginate buttons if more than one page
                visible: userMenu.userMenuUsers.pages > 1
                implicitWidth: parent.width

                RowLayout {
                    anchors.fill: parent

                    Item { Layout.fillWidth: true /* spacer */ }

                    Repeater {
                        model: userMenu.userMenuUsers.pages

                        ToolButton {
                            text: page
                            font.bold: userMenu.userMenuUsers.page === page

                            required property int index
                            readonly property int page: (index + 1)

                            onClicked: userMenu.userMenuUsers.page = page
                        }
                    }
                }
            }
        }
    }
}



QtExampleStyle/TextField.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Templates as T

T.TextField {
    id: control
    placeholderText: ""

    implicitWidth: Math.max(implicitBackgroundWidth + leftInset + rightInset, contentWidth + leftPadding + rightPadding)
    implicitHeight: Math.max(implicitBackgroundHeight + topInset + bottomInset,
                             contentHeight + topPadding + bottomPadding)

    background: Rectangle {
        implicitWidth: 200
        implicitHeight: 40
        radius: 8
        color: control.enabled ? "transparent" : "#353637"
        border.color: "#E0E2E7"
    }
}



QtExampleStyle/Button.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Controls
import QtQuick.Controls.impl
import QtQuick.Templates as T

T.Button {
    id: control

    property alias buttonColor: rect.color
    property alias textColor: label.color

    implicitWidth: Math.max(implicitBackgroundWidth + leftInset + rightInset,
                            implicitContentWidth + leftPadding + rightPadding)
    implicitHeight: Math.max(implicitBackgroundHeight + topInset + bottomInset,
                             implicitContentHeight + topPadding + bottomPadding)

    leftPadding: 15
    rightPadding: 15
    topPadding: 10
    bottomPadding: 10

    background: Rectangle {
        id: rect
        radius: 8
        border.color: "#E0E2E7"
        border.width: 1
        color: "#FFFFFF"
    }

    icon.width: 24
    icon.height: 24
    icon.color: control.palette.buttonText

    contentItem: IconLabel {
        id: label
        spacing: control.spacing
        mirrored: control.mirrored
        display: control.display

        icon: control.icon
        text: control.text
        font.pixelSize: 14
        color: "#667085"
    }
}



QtExampleStyle/Popup.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

import QtQuick
import QtQuick.Templates as T

T.Popup {
    id: control

    implicitWidth: Math.max(implicitBackgroundWidth + leftInset + rightInset,
                            implicitContentWidth + leftPadding + rightPadding)
    implicitHeight: Math.max(implicitBackgroundHeight + topInset + bottomInset,
                             implicitContentHeight + topPadding + bottomPadding)

    leftPadding: 15
    rightPadding: 15
    topPadding: 10
    bottomPadding: 10

    background: Rectangle {
        id: bg
        radius: 8
        border.color: "#E0E2E7"
        border.width: 2
        color: "#FFFFFF"
    }
}



QtExampleStyle/UIStyle.qml


// Copyright (C) 2023 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

pragma Singleton

import QtQuick

QtObject {
    id: uiStyle

    // Font Sizes
    readonly property int fontSizeXXS: 10
    readonly property int fontSizeXS: 15
    readonly property int fontSizeS: 20
    readonly property int fontSizeM: 25
    readonly property int fontSizeL: 30
    readonly property int fontSizeXL: 35
    readonly property int fontSizeXXL: 40

    // Color Scheme
    // Green
    readonly property color colorQtPrimGreen: "#41cd52"
    readonly property color colorQtAuxGreen1: "#21be2b"
    readonly property color colorQtAuxGreen2: "#17a81a"


    readonly property color colorAccent: "#ff99c8" //różowy
    readonly property color colorSecondary_2: "#fcf6bd" //żółty
    readonly property color colorGreen: "#d0f4de" //green
    readonly property color colorSecondary: "#a9def9" //blue
    readonly property color colorPrimary: "#00a884" //purple


    function iconPath(baseImagePath) {
        return `qrc:/qt/qml/ColorPalette/icons/${baseImagePath}.svg`
    }
}




QtExampleStyle/CMakeLists.txt


# Copyright (C) 2023 The Qt Company Ltd.
# SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

cmake_minimum_required(VERSION 3.16)
project(qtexamplestyle LANGUAGES CXX)

set(CMAKE_AUTOMOC ON)

find_package(Qt6 REQUIRED COMPONENTS Core Gui Quick QuickControls2)

set_source_files_properties(UIStyle.qml
    PROPERTIES
        QT_QML_SINGLETON_TYPE TRUE
)

qt_policy(SET QTP0001 NEW)
qt_add_qml_module(qtexamplestyle
    URI QtExampleStyle
    PLUGIN_TARGET qtexamplestyle
    QML_FILES
        Button.qml
        Popup.qml
        UIStyle.qml
        TextField.qml
)

target_link_libraries(qtexamplestyle PUBLIC
    Qt6::Core
    Qt6::Gui
    Qt6::Quick
    Qt6::QuickControls2
)

if(UNIX AND NOT APPLE AND CMAKE_CROSSCOMPILING)
    find_package(Qt6 REQUIRED COMPONENTS QuickTemplates2)

    # Work around QTBUG-86533
    target_link_libraries(qtexamplestyle PRIVATE Qt6::QuickTemplates2)
endif()

install(TARGETS qtexamplestyle
    RUNTIME DESTINATION "${CMAKE_INSTALL_BINDIR}/QtExampleStyle"
    LIBRARY DESTINATION "${CMAKE_INSTALL_LIBDIR}/QtExampleStyle"
)
install(FILES ${CMAKE_CURRENT_BINARY_DIR}/qmldir
    DESTINATION "${CMAKE_INSTALL_BINDIR}/QtExampleStyle"
)



